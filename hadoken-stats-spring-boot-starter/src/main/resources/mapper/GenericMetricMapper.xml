<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.analytics.starter.core.mapper.GenericMetricMapper">

    <!-- 数据写入 (来自Part 2) -->
    <insert id="batchUpsert">
        INSERT INTO ${tableName} (stat_time, metric_name, dimensions_hash, dimensions, metric_value)
        VALUES
        <foreach collection="list" item="item" separator=",">
            (#{item.stat_time}, #{item.metric_name}, #{item.dimensions_hash}, #{item.dimensions, typeHandler=com.baomidou.mybatisplus.extension.handlers.JacksonTypeHandler}, #{item.metric_value})
        </foreach>
        ON DUPLICATE KEY UPDATE
        metric_value = metric_value + VALUES(metric_value)
    </insert>

    <!-- 新增通用查询方法 -->
    <select id="query" resultType="java.util.Map">
        SELECT ${ew.sqlSelect} FROM ${tableName} ${ew.customSqlSegment}
    </select>

</mapper>
